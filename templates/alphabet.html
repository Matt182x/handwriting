<!DOCTYPE html>
<html>
<head>
  <title>Trace the Letter</title>
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.0/dist/signature_pad.umd.min.js"></script>
  <style>
    body {
      font-family: 'Comic Sans MS', 'Arial Rounded MT Bold', sans-serif;
      text-align: center;
      background: #fef6e4;
    }

    h1 {
      font-size: 120px;
      color: #333;
      margin: 10px;
    }

    .canvas-container {
      position: relative;
      display: inline-block;
    }

    canvas {
      border-radius: 20px;
      border: 4px dashed #ccc;
      touch-action: none;
    }

    #guideCanvas {
      z-index: 0;
      background: white;
    }

    #drawCanvas {
      z-index: 1;
      position: absolute;
      top: 0;
      left: 0;
      background: transparent;
    }

    button {
      font-size: 24px;
      padding: 12px 20px;
      margin: 10px;
      border-radius: 20px;
      border: none;
      background: #8bd3dd;
      cursor: pointer;
    }

    button:hover {
      background: #6ecad6;
    }

    #done {
      margin-top: 30px;
    }
  </style>
</head>
<body>

<h1 id="letter">a</h1>

<div class="canvas-container">
  <canvas id="guideCanvas" width="500" height="300"></canvas>
  <canvas id="drawCanvas" width="500" height="300"></canvas>
</div>
<br>

<button id="sound">ğŸ”Š Hear</button>
<button id="next">Next â¡ï¸</button>

<div id="done" style="display:none">
  <h2>Great job! ğŸ‰</h2>
  <a href="/generate_card/child_001">
    <button>Create My Card ğŸ’Œ</button>
  </a>
</div>

<script>
const letters = "abcdefghijklmnopqrstuvwxyz";
let index = 0;

// Canvases
const guideCanvas = document.getElementById("guideCanvas");
const guideCtx = guideCanvas.getContext("2d");
const drawCanvas = document.getElementById("drawCanvas");

// SignaturePad for strokes
const pad = new SignaturePad(drawCanvas, {
  minWidth: 6,
  maxWidth: 10,
  penColor: "#222"
});

// Draw faint guide letter
function drawGuideLetter(letter) {
  guideCtx.clearRect(0, 0, guideCanvas.width, guideCanvas.height);
  guideCtx.font = "200px Comic Sans MS";
  guideCtx.fillStyle = "#e0e0e0";
  guideCtx.textAlign = "center";
  guideCtx.textBaseline = "middle";
  guideCtx.fillText(letter, guideCanvas.width / 2, guideCanvas.height / 2 + 40);
}

// Initial draw
drawGuideLetter(letters[index]);

// Sound button
document.getElementById("sound").onclick = () => {
  speechSynthesis.speak(new SpeechSynthesisUtterance(letters[index]));
};

// Next button
document.getElementById("next").onclick = async () => {
  if (pad.isEmpty()) {
    alert("Try tracing the letter first ğŸ˜Š");
    return;
  }

  // --- Save only strokes ---
  const tracedOnly = drawCanvas.toDataURL(); // transparent background

  await fetch("/save_letter", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      letter: letters[index],
      image: tracedOnly
    })
  });

  // Clear strokes
  pad.clear();

  index++;
  if (index < letters.length) {
    document.getElementById("letter").innerText = letters[index];
    drawGuideLetter(letters[index]);
  } else {
    drawCanvas.style.display = "none";
    guideCanvas.style.display = "none";
    document.getElementById("next").style.display = "none";
    document.getElementById("sound").style.display = "none";
    document.getElementById("done").style.display = "block";
  }
};
</script>

</body>
</html>
